import{j as e,r as l,Q as k,R as J}from"./index-dd4f4c9f.js";import{a as z}from"./axios-1779699b.js";import{A as K,L as X}from"./Layout-0311dea1.js";import G from"./Loader-cdb4d57f.js";import{r as H}from"./index-5fe2242d.js";import{q,_ as A}from"./transition-ef59bab0.js";import{P as V,S as _,r as m}from"./PDFButton-bf045ba4.js";function Z({columns:b,data:p}){const{getTableProps:v,getTableBodyProps:u,headerGroups:w,prepareRow:j,page:P,nextPage:g,previousPage:T,canPreviousPage:f,canNextPage:x,state:{pageIndex:h,pageSize:N}}=H.useTable({columns:b,data:p,initialState:{pageIndex:0,pageSize:5}},H.useSortBy,H.usePagination);return e.jsx("div",{className:"container mx-auto bg-white rounded-lg shadow-lg overflow-hidden p-0",children:p.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center my-8",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No data to display"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{...v(),className:"min-w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-black uppercase bg-gray-200 border border-gray-600 shadow-[inset_0_0_8px_rgba(0,0,0,0.6)]",children:w.map(c=>l.createElement("tr",{...c.getHeaderGroupProps(),key:c.id},c.headers.map(d=>l.createElement("th",{...d.getHeaderProps(d.getSortByToggleProps()),className:"px-4 py-2 cursor-pointer",key:d.id},d.render("Header"),d.isSorted?d.isSortedDesc?" ▼":" ▲":""))))}),e.jsx("tbody",{...u(),className:"bg-white divide-y divide-gray-200",children:P.map(c=>(j(c),l.createElement("tr",{...c.getRowProps(),className:"hover:bg-gray-100 transition-colors duration-200",key:c.id},c.cells.map(d=>l.createElement("td",{...d.getCellProps(),className:"px-4 py-2",key:d.column.id},d.render("Cell"))))))})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-4 py-2 bg-gray-200",children:e.jsxs("div",{children:[e.jsx("button",{onClick:T,disabled:!f,className:`px-4 py-2 rounded-lg ${f?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Previous"}),e.jsxs("span",{className:"mx-4 text-gray-600",children:["Page ",e.jsx("strong",{children:h+1})," of ",e.jsx("strong",{children:Math.ceil(p.length/N)})]}),e.jsx("button",{onClick:g,disabled:!x,className:`px-4 py-2 rounded-lg ${x?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})})]})})}function ee({isOpen:b,onRequestClose:p,orderId:v}){const[u,w]=l.useState({name:"",email:"",phoneNumber:"",reason:"",productPhoto:null}),[j,P]=l.useState(!1),g=f=>{const{name:x,value:h,type:N,files:c}=f.target;w(N==="file"?{...u,productPhoto:c[0]}:{...u,[x]:h})},T=async f=>{f.preventDefault();const{name:x,email:h,phoneNumber:N,reason:c,productPhoto:d}=u,y=new FormData;y.append("name",x),y.append("email",h),y.append("phoneNumber",N),y.append("reason",c),y.append("uniqueOrderId",v),d&&y.append("productPhoto",d),P(!0);try{const t=await z.post("https://endpoints-ashy.vercel.app/api/order/cancel-request",y,{headers:{"Content-Type":"multipart/form-data"}});k.success(t.data.message),w({name:"",email:"",phoneNumber:"",reason:"",productPhoto:null}),p()}catch(t){k.error("Error submitting request: "+t.message)}finally{P(!1)}};return e.jsx(q,{appear:!0,show:b,as:l.Fragment,children:e.jsxs(A,{as:"div",className:"relative z-10",onClose:p,children:[e.jsx(q.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(q.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(A.Panel,{className:"w-full max-w-4xl bg-[#ddd5c9] p-6 rounded-lg shadow-lg overflow-auto max-h-[90vh]",children:e.jsxs("div",{className:"flex flex-col space-y-6",style:{marginTop:"3rem"},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-semibold text-[rgb(60,42,33)]",children:"Cancel/Return Order"}),e.jsx("button",{type:"button",onClick:p,className:"text-gray-500 hover:text-gray-700",children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:T,className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Full Name"}),e.jsx("input",{value:u.name,onChange:g,type:"text",name:"name",id:"name",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Email"}),e.jsx("input",{value:u.email,onChange:g,type:"email",name:"email",id:"email",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Phone Number"}),e.jsx("input",{value:u.phoneNumber,onChange:g,type:"text",name:"phoneNumber",id:"phoneNumber",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"productPhoto",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Product Photo"}),e.jsx("input",{onChange:g,type:"file",name:"productPhoto",id:"productPhoto",accept:"image/*",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Reason for Cancellation/Return"}),e.jsx("textarea",{value:u.reason,onChange:g,name:"reason",id:"reason",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full text-white bg-[rgb(60,42,33)] py-2 rounded-lg font-medium hover:bg-opacity-80 transition",disabled:j,children:j?"Submitting...":"Submit"})]})]})})})})]})})}function de(){const[b,p]=l.useState([]),[v,u]=l.useState({}),[w,j]=l.useState(!1),[P,g]=l.useState(null),[T,f]=l.useState(!0),x=JSON.parse(localStorage.getItem("user")),h=x?x.userId:null;l.useEffect(()=>{h&&(async()=>{try{const o=await z.get(`https://endpoints-ashy.vercel.app/api/order/getorder/${h}`);if(o.data.success){const r=o.data.orders;r.sort((a,O)=>new Date(O.orderDate)-new Date(a.orderDate)),p(r)}else k.error("Failed to fetch orders")}catch(o){console.error("Error fetching orders:",o)}finally{f(!1)}})()},[h]);const N=async t=>{var o,r;if(!t)return k.error("Shipment ID is required."),null;try{return(await z.get(`https://endpoints-ashy.vercel.app/api/track/track/${t}`)).data}catch(a){return console.error("Error tracking shipment:",a),k.error("Error tracking shipment: "+(((r=(o=a.response)==null?void 0:o.data)==null?void 0:r.message)||a.message)),null}};l.useEffect(()=>{const t=async()=>{const o={};for(const r of b)if(r.shipmentId){const a=await N(r.shipmentId);a?o[r.shipmentId]={currentStatus:a.current_status,deliveredDate:a.delivered_date}:o[r.shipmentId]={currentStatus:"Not Available",deliveredDate:null}}u(o)};b.length>0&&t()},[b]);const c=t=>{if(!t)return!1;const o=new Date(t),r=new Date;console.log(o);const a=(r-o)/(1e3*60*60);return console.log(a),a<-48},d=async t=>{const o=await V.create(),r=o.addPage([600,800]),a=await o.embedFont(_.HelveticaBold),O=await o.embedFont(_.TimesRoman),n=50;let s=r.getHeight()-50;r.drawText("HEKAWY Invoice",{x:n,y:s,size:30,font:a,color:m(0,0,0)}),s-=40,r.drawText(`Customer Name: ${t.addressInfo.name}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20,r.drawText(`Customer Phone Number: ${t.addressInfo.phoneNumber}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20,r.drawText(`Customer Email: ${t.email}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20;const L=`${t.addressInfo.roomNo}, ${t.addressInfo.society}, ${t.addressInfo.street}, ${t.addressInfo.city}, ${t.addressInfo.pincode}`;r.drawText(`Address: ${L}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20,r.drawText(`Order ID: ${t.uniqueOrderId}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20,r.drawText(`Payment Method: ${t.paymentMethod}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=20,r.drawText(`Payment Status: ${t.status}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),t.paymentMethod==="Online"&&(s-=20,r.drawText(`Payment ID: ${t.paymentId}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)})),s-=20,r.drawText(`Order Date: ${new Date(t.orderDate).toLocaleString()}`,{x:n,y:s,size:12,font:a,color:m(0,0,0)}),s-=40;const S=(D,$,I,U,Q,W,Y)=>{r.drawText(D,{x:$+5,y:I+5,size:Y,font:W,color:m(0,0,0)}),r.drawRectangle({x:$,y:I,width:U,height:Q,borderColor:m(0,0,0),borderWidth:1})},F=20,C=20,i=[300,100,100];S("Product Name",n,s,i[0],F,a,12),S("Quantity",n+i[0],s,i[1],F,a,12),S("Price (Rs.)",n+i[0]+i[1],s,i[2],F,a,12),s-=F,t.cartItems.forEach(D=>{var $,I;S(D.name||"N/A",n,s,i[0],C,O,12),S((($=D.quantity)==null?void 0:$.toString())||"0",n+i[0],s,i[1],C,O,12),S(((I=D.price)==null?void 0:I.toString())||"0.00",n+i[0]+i[1],s,i[2],C,O,12),s-=C}),s-=C,S(`Total Amount (Rs.): ${t.grandTotal}`,n,s,i[0]+i[1]+i[2],C,a,14);const B=await o.save(),M=new Blob([B],{type:"application/pdf"}),R=URL.createObjectURL(M),E=document.createElement("a");E.href=R,E.download=`Invoice_${t.uniqueOrderId}.pdf`,E.click(),URL.revokeObjectURL(R)},y=J.useMemo(()=>[{Header:"Order Id",accessor:"uniqueOrderId"},{Header:"Product Info",accessor:t=>{const o=t.cartItems.map(r=>(`${r.imageUrls[0]}`,`
              <div style="margin-bottom: 20px; padding-bottom: 10px;">
              <div style="text-align: center;">
                <div><strong>Product Name:</strong> ${r.name}</div>
                <div><strong>Price:</strong> ₹${r.price}</div>
                <div><strong>Category:</strong> ${r.category.name||"N/A"}</div>
                <div><strong>Color:</strong>
                  <button
                    class="w-8 h-8 rounded-full border-2"
                    style="background-color: ${r.selectedColor}"
                  ></button>
                </div>
                <div><strong>Size:</strong> ${r.selectedSize}</div>
                <div><strong>Quantity:</strong> ${r.quantity}</div>
              </div>
            </div>
            `)).join("<br/><br/>");return e.jsx("div",{dangerouslySetInnerHTML:{__html:o}})}},{Header:"Total",accessor:"grandTotal"},{Header:"Payment Status",accessor:t=>t.status},{Header:"Order Shipping Status",accessor:t=>{var o;return((o=v[t.shipmentId])==null?void 0:o.currentStatus)||"Pending"}},{Header:"Actions",accessor:t=>{const o=v[t.shipmentId]||{},r=o.deliveredDate,a=o.currentStatus==="shipped"&&r&&c(r);return r?a?e.jsx("button",{onClick:()=>{g(t.uniqueOrderId),j(!0)},className:"text-white bg-[rgb(60,42,33)] py-2 px-4 rounded",children:"Cancel Order"}):e.jsx("span",{className:"text-gray-500",children:"Cancel Order time is over"}):e.jsx("span",{className:"text-gray-500",children:"Order not yet delivered"})}},{Header:"Download Invoice",accessor:t=>e.jsx("div",{className:"flex gap-2 cursor-pointer text-black",children:e.jsx("button",{onClick:()=>d(t),className:"px-4 py-2 bg-[#3C2A21] text-white rounded-lg",children:"Download Invoice"})})}],[v]);return e.jsxs(X,{children:[T&&e.jsx(G,{}),e.jsxs("div",{className:"flex flex-col",style:{marginBottom:"15rem"},children:[e.jsx("div",{className:"w-full",children:e.jsx("h2",{className:"text-center text-3xl font-bold mb-4",style:{color:"#3C2A21",marginTop:"3rem"},children:"Order Details"})}),e.jsx("div",{className:"w-full overflow-x-auto items-center justify-center",children:e.jsx(Z,{columns:y,data:b})})]}),e.jsx(ee,{isOpen:w,onRequestClose:()=>j(!1),orderId:P})]})}export{de as default};
