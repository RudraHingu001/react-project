import{j as e,r as o,Q as j,R as I}from"./index-09219173.js";import{a as P}from"./axios-1779699b.js";import{A as D,L as O}from"./Layout-c17a04c3.js";import k from"./Loader-ca36df74.js";import{r as S}from"./index-30744ab8.js";import{q as w,_ as C}from"./transition-0d021acc.js";function $({columns:p,data:i}){const{getTableProps:y,getTableBodyProps:d,headerGroups:h,prepareRow:x,page:f,nextPage:c,previousPage:v,canPreviousPage:g,canNextPage:m,state:{pageIndex:u,pageSize:b}}=S.useTable({columns:p,data:i,initialState:{pageIndex:0,pageSize:5}},S.useSortBy,S.usePagination);return e.jsx("div",{className:"container mx-auto bg-white rounded-lg shadow-lg overflow-hidden p-0",children:i.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center my-8",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No data to display"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{...y(),className:"min-w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-black uppercase bg-gray-200 border border-gray-600 shadow-[inset_0_0_8px_rgba(0,0,0,0.6)]",children:h.map(l=>o.createElement("tr",{...l.getHeaderGroupProps(),key:l.id},l.headers.map(n=>o.createElement("th",{...n.getHeaderProps(n.getSortByToggleProps()),className:"px-4 py-2 cursor-pointer",key:n.id},n.render("Header"),n.isSorted?n.isSortedDesc?" ▼":" ▲":""))))}),e.jsx("tbody",{...d(),className:"bg-white divide-y divide-gray-200",children:f.map(l=>(x(l),o.createElement("tr",{...l.getRowProps(),className:"hover:bg-gray-100 transition-colors duration-200",key:l.id},l.cells.map(n=>o.createElement("td",{...n.getCellProps(),className:"px-4 py-2",key:n.column.id},n.render("Cell"))))))})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-4 py-2 bg-gray-200",children:e.jsxs("div",{children:[e.jsx("button",{onClick:v,disabled:!g,className:`px-4 py-2 rounded-lg ${g?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Previous"}),e.jsxs("span",{className:"mx-4 text-gray-600",children:["Page ",e.jsx("strong",{children:u+1})," of ",e.jsx("strong",{children:Math.ceil(i.length/b)})]}),e.jsx("button",{onClick:c,disabled:!m,className:`px-4 py-2 rounded-lg ${m?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})})]})})}function F({isOpen:p,onRequestClose:i,orderId:y}){const[d,h]=o.useState({name:"",email:"",phoneNumber:"",reason:"",productPhoto:null}),[x,f]=o.useState(!1),c=g=>{const{name:m,value:u,type:b,files:l}=g.target;h(b==="file"?{...d,productPhoto:l[0]}:{...d,[m]:u})},v=async g=>{g.preventDefault();const{name:m,email:u,phoneNumber:b,reason:l,productPhoto:n}=d,t=new FormData;t.append("name",m),t.append("email",u),t.append("phoneNumber",b),t.append("reason",l),t.append("uniqueOrderId",y),n&&t.append("productPhoto",n),f(!0);try{const r=await P.post("http://localhost:3000/api/order/cancel-request",t,{headers:{"Content-Type":"multipart/form-data"}});j.success(r.data.message),h({name:"",email:"",phoneNumber:"",reason:"",productPhoto:null}),i()}catch(r){j.error("Error submitting request: "+r.message)}finally{f(!1)}};return e.jsx(w,{appear:!0,show:p,as:o.Fragment,children:e.jsxs(C,{as:"div",className:"relative z-10",onClose:i,children:[e.jsx(w.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(w.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(C.Panel,{className:"w-full max-w-4xl bg-[#ddd5c9] p-6 rounded-lg shadow-lg overflow-auto max-h-[90vh]",children:e.jsxs("div",{className:"flex flex-col space-y-6",style:{marginTop:"3rem"},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-semibold text-[rgb(60,42,33)]",children:"Cancel/Return Order"}),e.jsx("button",{type:"button",onClick:i,className:"text-gray-500 hover:text-gray-700",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:v,className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Full Name"}),e.jsx("input",{value:d.name,onChange:c,type:"text",name:"name",id:"name",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Email"}),e.jsx("input",{value:d.email,onChange:c,type:"email",name:"email",id:"email",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Phone Number"}),e.jsx("input",{value:d.phoneNumber,onChange:c,type:"text",name:"phoneNumber",id:"phoneNumber",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"productPhoto",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Product Photo"}),e.jsx("input",{onChange:c,type:"file",name:"productPhoto",id:"productPhoto",accept:"image/*",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Reason for Cancellation/Return"}),e.jsx("textarea",{value:d.reason,onChange:c,name:"reason",id:"reason",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full text-white bg-[rgb(60,42,33)] py-2 rounded-lg font-medium hover:bg-opacity-80 transition",disabled:x,children:x?"Submitting...":"Submit"})]})]})})})})]})})}function M(){const[p,i]=o.useState([]),[y,d]=o.useState({}),[h,x]=o.useState(!1),[f,c]=o.useState(null),[v,g]=o.useState(!0),m=JSON.parse(localStorage.getItem("user")),u=m?m.userId:null;o.useEffect(()=>{u&&(async()=>{try{const r=await P.get(`http://localhost:3000/api/order/getorder/${u}`);if(r.data.success){const a=r.data.orders;a.sort((s,N)=>new Date(N.orderDate)-new Date(s.orderDate)),i(a)}else j.error("Failed to fetch orders")}catch(r){console.error("Error fetching orders:",r)}finally{g(!1)}})()},[u]);const b=async t=>{var r,a;if(!t)return j.error("Shipment ID is required."),null;try{return(await P.get(`http://localhost:3000/api/track/track/${t}`)).data}catch(s){return console.error("Error tracking shipment:",s),j.error("Error tracking shipment: "+(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message)),null}};o.useEffect(()=>{const t=async()=>{const r={};for(const a of p)if(a.shipmentId){const s=await b(a.shipmentId);s?r[a.shipmentId]={currentStatus:s.current_status,deliveredDate:s.delivered_date}:r[a.shipmentId]={currentStatus:"Not Available",deliveredDate:null}}d(r)};p.length>0&&t()},[p]);const l=t=>{if(!t)return!1;const r=new Date(t),a=new Date;console.log(r);const s=(a-r)/(1e3*60*60);return console.log(s),s<-48},n=I.useMemo(()=>[{Header:"Order Id",accessor:"uniqueOrderId"},{Header:"Name",accessor:t=>t.addressInfo.name},{Header:"Address",accessor:t=>`${t.addressInfo.roomNo||""}, ${t.addressInfo.society||""}, ${t.addressInfo.street||""}, ${t.addressInfo.city||""} , ${t.addressInfo.pincode}`},{Header:"Phone Number",accessor:t=>t.addressInfo.phoneNumber},{Header:"Email",accessor:"email"},{Header:"Date",accessor:t=>{const r=new Date(t.orderDate),a=String(r.getDate()).padStart(2,"0"),s=String(r.getMonth()+1).padStart(2,"0"),N=r.getFullYear();return`${a}-${s}-${N}`}},{Header:"Product Info",accessor:t=>{const r=t.cartItems.map(a=>`
              <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                <div style="text-align: center;">
                  <img src="${`http://localhost:3000${a.imageUrls[0]}`}" alt="${a.name}" style="max-width: 150px; height: auto; display: block; margin: 0 auto;" />
                </div>
                <div style="text-align: center;">
                  <div><strong>Product Name:</strong> ${a.name}</div>
                  <div><strong>Price:</strong> ₹${a.price}</div>
                  <div><strong>Category:</strong> ${a.category.name||"N/A"}</div>
                  <div><strong>Color:</strong> ${a.selectedColor}</div>
                  <div><strong>Size:</strong> ${a.selectedSize}</div>
                  <div><strong>Quantity:</strong> ${a.quantity}</div>
                </div>
              </div>
            `).join("<br/><br/>");return e.jsx("div",{dangerouslySetInnerHTML:{__html:r}})}},{Header:"Total",accessor:"grandTotal"},{Header:"Payment Status",accessor:t=>t.paymentStatus},{Header:"Order Shipping Status",accessor:t=>{var r;return((r=y[t.shipmentId])==null?void 0:r.currentStatus)||"Pending"}},{Header:"Actions",accessor:t=>l("2024-11-29")?e.jsx("button",{onClick:()=>{c(t.uniqueOrderId),x(!0)},className:"text-white bg-[rgb(60,42,33)] py-2 px-4 rounded",children:"Cancel Order"}):e.jsx("span",{className:"text-gray-500",children:"Cancel Order time is over"})}],[y]);return e.jsxs(O,{children:[v&&e.jsx(k,{}),e.jsxs("div",{className:"flex flex-col",style:{marginBottom:"15rem"},children:[e.jsx("div",{className:"w-full",children:e.jsx("h2",{className:"text-center text-3xl font-bold mb-4",style:{color:"#3C2A21",marginTop:"3rem"},children:"Order Details"})}),e.jsx("div",{className:"w-full overflow-x-auto items-center justify-center",children:e.jsx($,{columns:n,data:p})})]}),e.jsx(F,{isOpen:h,onRequestClose:()=>x(!1),orderId:f})]})}export{M as default};
