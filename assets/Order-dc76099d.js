import{j as e,r as s,Q as j,R as I}from"./index-a9367179.js";import{m as k}from"./myContext-6d38728e.js";import{A as O,L as E}from"./Layout-3ea1fd0a.js";import H from"./Loader-d4399127.js";import{a as $,c as F,f as T,b as P}from"./FirebaseConfig-aa7fb936.js";import{r as N}from"./index-cfef9a6f.js";import{q as w,_ as S,a as q}from"./transition-5d41f9b4.js";import{g as D,r as U,u as R,a as _}from"./index.esm2017-dfb43fad.js";import"./index-bea2a320-8c0c8ce8.js";function A({columns:y,data:m}){const{getTableProps:g,getTableBodyProps:n,headerGroups:p,prepareRow:u,page:x,nextPage:f,previousPage:i,canPreviousPage:h,canNextPage:b,state:{pageIndex:d,pageSize:c}}=N.useTable({columns:y,data:m,initialState:{pageIndex:0,pageSize:5}},N.useSortBy,N.usePagination);return e.jsx("div",{className:"container mx-auto bg-white rounded-lg shadow-lg overflow-hidden p-0",children:m.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center my-8",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No data to display"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{...g(),className:"min-w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-black uppercase bg-gray-200 border border-gray-600 shadow-[inset_0_0_8px_rgba(0,0,0,0.6)]",children:p.map(a=>s.createElement("tr",{...a.getHeaderGroupProps(),key:a.id},a.headers.map(t=>s.createElement("th",{...t.getHeaderProps(t.getSortByToggleProps()),className:"px-4 py-2 cursor-pointer",key:t.id},t.render("Header"),t.isSorted?t.isSortedDesc?" ▼":" ▲":""))))}),e.jsx("tbody",{...n(),className:"bg-white divide-y divide-gray-200",children:x.map(a=>(u(a),s.createElement("tr",{...a.getRowProps(),className:"hover:bg-gray-100 transition-colors duration-200",key:a.id},a.cells.map(t=>s.createElement("td",{...t.getCellProps(),className:"px-4 py-2",key:t.column.id},t.render("Cell"))))))})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-4 py-2 bg-gray-200",children:e.jsxs("div",{children:[e.jsx("button",{onClick:i,disabled:!h,className:`px-4 py-2 rounded-lg ${h?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Previous"}),e.jsxs("span",{className:"mx-4 text-gray-600",children:["Page ",e.jsx("strong",{children:d+1})," of ",e.jsx("strong",{children:Math.ceil(m.length/c)})]}),e.jsx("button",{onClick:f,disabled:!b,className:`px-4 py-2 rounded-lg ${b?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})})]})})}function L({isOpen:y,onRequestClose:m,orderId:g}){const[n,p]=s.useState({name:"",email:"",phoneNumber:"",reason:"",productPhoto:null}),[u,x]=s.useState(!1),f=D(),i=d=>{const{name:c,value:a,type:t,files:o}=d.target;p(t==="file"?{...n,productPhoto:o[0]}:{...n,[c]:a})},h=async d=>{const c=U(f,`productPhotos/${d.name}`);x(!0);try{return await R(c,d),await _(c)}catch(a){return console.error("Error uploading image:",a),j.error("Error uploading image"),null}finally{x(!1)}},b=async d=>{d.preventDefault();const{name:c,email:a,phoneNumber:t,reason:o,productPhoto:r}=n;let l="";if(!(r&&(l=await h(r),!l)))try{await $(F(T,"cancelRequests"),{name:c,email:a,phoneNumber:t,reason:o,productPhoto:l,uniqueOrderId:g,createdAt:new Date}),j.success("Your cancellation request has been submitted!"),m()}catch(v){j.error("Error submitting request: "+v.message)}};return e.jsx(w,{appear:!0,show:y,as:s.Fragment,children:e.jsxs(S,{as:"div",className:"relative z-10",onClose:m,children:[e.jsx(w.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(w.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(S.Panel,{className:"w-full max-w-4xl bg-[#ddd5c9] p-6 rounded-lg shadow-lg overflow-auto max-h-[90vh]",children:e.jsxs("div",{className:"flex flex-col space-y-6",style:{marginTop:"3rem"},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-semibold text-[rgb(60,42,33)]",children:"Cancel/Return Order"}),e.jsx("button",{type:"button",onClick:m,className:"text-gray-500 hover:text-gray-700",children:e.jsx(O,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:b,className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Full Name"}),e.jsx("input",{value:n.name,onChange:i,type:"text",name:"name",id:"name",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Email"}),e.jsx("input",{value:n.email,onChange:i,type:"email",name:"email",id:"email",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Phone Number"}),e.jsx("input",{value:n.phoneNumber,onChange:i,type:"text",name:"phoneNumber",id:"phoneNumber",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"productPhoto",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Product Photo"}),e.jsx("input",{onChange:i,type:"file",name:"productPhoto",id:"productPhoto",accept:"image/*",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block mb-2 text-sm font-medium text-[rgb(60,42,33)]",children:"Reason for Cancellation/Return"}),e.jsx("textarea",{value:n.reason,onChange:i,name:"reason",id:"reason",className:"w-full border border-gray-300 rounded-lg p-2 bg-white text-gray-900",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full text-white bg-[rgb(60,42,33)] py-2 rounded-lg font-medium hover:bg-opacity-80 transition",disabled:u,children:u?"Submitting...":"Submit"})]})]})})})})]})})}function W(){const y=s.useContext(k),{loading:m,order:g}=y,[n,p]=s.useState([]),[u,x]=s.useState({}),[f,i]=s.useState(!1),[h,b]=s.useState(null),d=P.currentUser?P.currentUser.email:null;s.useEffect(()=>{if(d){const t=g.filter(o=>o.email===d);t.sort((o,r)=>new Date(r.date)-new Date(o.date)),p(t)}},[g,d]);const c=async t=>{var o,r;if(!t)return j.error("Shipment ID is required."),null;try{return(await q.get(`https://endpoints-ashy.vercel.app/api/track/track/${t}`)).data}catch(l){return console.error("Error tracking shipment:",l),j.error("Error tracking shipment: "+(((r=(o=l.response)==null?void 0:o.data)==null?void 0:r.message)||l.message)),null}};s.useEffect(()=>{const t=async()=>{const o={};for(const r of n)if(r.shipmentId){const l=await c(r.shipmentId);o[r.shipmentId]=l?l.current_status:"Not Available"}x(o)};n.length>0&&t()},[n]);const a=I.useMemo(()=>[{Header:"Order Id",accessor:"uniqueOrderId"},{Header:"Name",accessor:t=>t.addressInfo.name},{Header:"Address",accessor:t=>`${t.addressInfo.roomNo||""}, ${t.addressInfo.society||""}, ${t.addressInfo.street||""}, ${t.addressInfo.city||""} , ${t.addressInfo.pincode}`},{Header:"Phone Number",accessor:t=>t.addressInfo.phoneNumber},{Header:"Email",accessor:"email"},{Header:"Date",accessor:t=>t.date},{Header:"Product Info",accessor:t=>{const o=t.cartItems.map(r=>{const l=r.colors.find(C=>C.hex===r.selectedColor),v=l?l.name:"Unknown Color";return`
              <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                <div style="text-align: center;">
                  <img src="${r.imageUrls[0]}" alt="${r._id}" style="max-width: 150px; height: auto; display: block; margin: 0 auto;" />
                </div>
                <div style="text-align: center;">
                  <div><strong>Product Name:</strong> ${r._id}</div>
                  <div><strong>Category:</strong> ${r.category}</div>
                  <div><strong>Color:</strong> ${v}</div>
                  <div><strong>Size:</strong> ${r.selectedSize}</div>
                  <div><strong>Quantity:</strong> ${r.quantity}</div>
                </div>
              </div>
            `}).join("<br/><br/>");return e.jsx("div",{dangerouslySetInnerHTML:{__html:o}})}},{Header:"Total",accessor:"grandTotal"},{Header:"Payment Status",accessor:t=>t.status},{Header:"Order Shipping Status",accessor:t=>u[t.shipmentId]||"Pending"},{Header:"Actions",accessor:t=>e.jsx("button",{onClick:()=>{b(t.uniqueOrderId),i(!0)},className:"text-white bg-[rgb(60,42,33)] py-2 px-4 rounded",children:"Cancel Order"})}],[u]);return e.jsxs(E,{children:[m&&e.jsx(H,{}),e.jsxs("div",{className:"flex flex-col",style:{marginBottom:"15rem"},children:[e.jsx("div",{className:"w-full",children:e.jsx("h2",{className:"text-center text-3xl font-bold mb-4",style:{color:"#3C2A21",marginTop:"3rem"},children:"Order Details"})}),e.jsx("div",{className:"w-full overflow-x-auto items-center justify-center",children:e.jsx(A,{columns:a,data:n})})]}),e.jsx(L,{isOpen:f,onRequestClose:()=>i(!1),orderId:h})]})}export{W as default};
