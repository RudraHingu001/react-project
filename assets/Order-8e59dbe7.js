import{j as e,r as o,R as S,Q as C}from"./index-91e4566e.js";import{m as w}from"./myContext-58528e02.js";import{L as I}from"./Layout-87ba07b9.js";import H from"./Loader-d3f9bc3d.js";import{c as k,f as O,a as P}from"./FirebaseConfig-863835c9.js";import{r as v}from"./index-b548e56c.js";import{a as $}from"./axios-1779699b.js";import"./index-bea2a320-8c0c8ce8.js";function D({columns:d,data:g}){const{getTableProps:i,getTableBodyProps:l,headerGroups:c,prepareRow:x,page:m,nextPage:u,previousPage:f,canPreviousPage:p,canNextPage:h,state:{pageIndex:y,pageSize:b}}=v.useTable({columns:d,data:g,initialState:{pageIndex:0,pageSize:5}},v.useSortBy,v.usePagination);return e.jsx("div",{className:"container mx-auto bg-white rounded-lg shadow-lg overflow-hidden p-0",children:g.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center my-8",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No data to display"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{...i(),className:"min-w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-black uppercase bg-gray-200 border border-gray-600 shadow-[inset_0_0_8px_rgba(0,0,0,0.6)]",children:c.map(n=>o.createElement("tr",{...n.getHeaderGroupProps(),key:n.id},n.headers.map(t=>o.createElement("th",{...t.getHeaderProps(t.getSortByToggleProps()),className:"px-4 py-2 cursor-pointer",key:t.id},t.render("Header"),t.isSorted?t.isSortedDesc?" ▼":" ▲":""))))}),e.jsx("tbody",{...l(),className:"bg-white divide-y divide-gray-200",children:m.map(n=>(x(n),o.createElement("tr",{...n.getRowProps(),className:"hover:bg-gray-100 transition-colors duration-200",key:n.id},n.cells.map(t=>o.createElement("td",{...t.getCellProps(),className:"px-4 py-2",key:t.column.id},t.render("Cell"))))))})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-4 py-2 bg-gray-200",children:e.jsxs("div",{children:[e.jsx("button",{onClick:f,disabled:!p,className:`px-4 py-2 rounded-lg ${p?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Previous"}),e.jsxs("span",{className:"mx-4 text-gray-600",children:["Page ",e.jsx("strong",{children:y+1})," of ",e.jsx("strong",{children:Math.ceil(g.length/b)})]}),e.jsx("button",{onClick:u,disabled:!h,className:`px-4 py-2 rounded-lg ${h?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})})]})})}function E(){const[d,g]=o.useState("createdAt"),[i,l]=o.useState(!1),[c,x]=o.useState(0),m=5,[u,f,p]=useCollection(k(O,"cancelRequests"),{snapshotListenOptions:{includeMetadataChanges:!0}}),h=S.useMemo(()=>[{Header:"Full Name",accessor:"name"},{Header:"Email",accessor:"email"},{Header:"Phone Number",accessor:"phoneNumber"},{Header:"Reason for Cancellation/Return",accessor:"reason"},{Header:"Product Photo",accessor:s=>e.jsx("img",{src:s.productPhoto,alt:"Product",style:{width:"100px",height:"auto"}})},{Header:"Date",accessor:s=>new Date(s.createdAt).toLocaleString()}],[]),y=s=>{s===d?l(!i):(g(s),l(!1))},b=S.useMemo(()=>u?[...u.docs].sort((r,a)=>{const j=r.data(),N=a.data();return j[d]<N[d]?i?1:-1:j[d]>N[d]?i?-1:1:0}).map(r=>({id:r.id,...r.data()})):[],[u,d,i]),n=b.slice(c*m,(c+1)*m),t=Math.ceil(b.length/m);return f?e.jsx("p",{children:"Loading..."}):p?e.jsxs("p",{children:["Error: ",p.message]}):e.jsxs("div",{className:"px-4 md:px-0 mb-16",style:{marginBottom:"10rem"},children:[e.jsx("h1",{className:"text-center mb-5 text-3xl font-semibold underline",children:"Cancellation Requests"}),e.jsxs("div",{className:"relative overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-black uppercase bg-gray-200 border border-gray-600 shadow-[inset_0_0_8px_rgba(0,0,0,0.6)]",children:e.jsx("tr",{children:h.map(s=>e.jsxs("th",{onClick:()=>y(s.accessor),className:"px-4 py-2 cursor-pointer",children:[s.Header,d===s.accessor?i?" ▼":" ▲":""]},s.Header))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((s,r)=>e.jsx("tr",{className:"hover:bg-gray-100 transition-colors duration-200",children:h.map(a=>e.jsx("td",{className:"px-4 py-2",children:a.accessor instanceof Function?a.accessor(s):s[a.accessor]},a.Header))},r))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 px-4 py-2 bg-gray-200",children:[e.jsx("button",{onClick:()=>x(s=>Math.max(s-1,0)),disabled:c===0,className:`px-4 py-2 rounded-lg ${c>0?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Previous"}),e.jsxs("span",{className:"mx-4 text-gray-600",children:["Page ",e.jsx("strong",{children:c+1})," of ",e.jsx("strong",{children:t})]}),e.jsx("button",{onClick:()=>x(s=>Math.min(s+1,t-1)),disabled:c>=t-1,className:`px-4 py-2 rounded-lg ${c<t-1?"bg-[#3C2A21] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Next"})]})]})]})}function U(){const d=o.useContext(w),{loading:g,order:i}=d,[l,c]=o.useState([]),[x,m]=o.useState({}),[u,f]=o.useState(!1),[p,h]=o.useState(null),y=P.currentUser?P.currentUser.email:null;o.useEffect(()=>{if(y){const t=i.filter(s=>s.email===y);t.sort((s,r)=>new Date(r.date)-new Date(s.date)),c(t)}},[i,y]);const b=async t=>{var s,r;if(!t)return C.error("Shipment ID is required."),null;try{return(await $.get(`https://endpoints-ashy.vercel.app/api/track/track/${t}`)).data}catch(a){return console.error("Error tracking shipment:",a),C.error("Error tracking shipment: "+(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message)),null}};o.useEffect(()=>{const t=async()=>{const s={};for(const r of l)if(r.shipmentId){const a=await b(r.shipmentId);s[r.shipmentId]=a?a.current_status:"Not Available"}m(s)};l.length>0&&t()},[l]);const n=S.useMemo(()=>[{Header:"Order Id",accessor:"uniqueOrderId"},{Header:"Name",accessor:t=>t.addressInfo.name},{Header:"Address",accessor:t=>`${t.addressInfo.roomNo||""}, ${t.addressInfo.society||""}, ${t.addressInfo.street||""}, ${t.addressInfo.city||""} , ${t.addressInfo.pincode}`},{Header:"Phone Number",accessor:t=>t.addressInfo.phoneNumber},{Header:"Email",accessor:"email"},{Header:"Date",accessor:t=>t.date},{Header:"Product Info",accessor:t=>{const s=t.cartItems.map(r=>{const a=r.colors.find(N=>N.hex===r.selectedColor),j=a?a.name:"Unknown Color";return`
              <div style="margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                <div style="text-align: center;">
                  <img src="${r.imageUrls[0]}" alt="${r._id}" style="max-width: 150px; height: auto; display: block; margin: 0 auto;" />
                </div>
                <div style="text-align: center;">
                  <div><strong>Product Name:</strong> ${r._id}</div>
                  <div><strong>Category:</strong> ${r.category}</div>
                  <div><strong>Color:</strong> ${j}</div>
                  <div><strong>Size:</strong> ${r.selectedSize}</div>
                  <div><strong>Quantity:</strong> ${r.quantity}</div>
                </div>
              </div>
            `}).join("<br/><br/>");return e.jsx("div",{dangerouslySetInnerHTML:{__html:s}})}},{Header:"Total",accessor:"grandTotal"},{Header:"Payment Status",accessor:t=>t.status},{Header:"Order Shipping Status",accessor:t=>x[t.shipmentId]||"Pending"},{Header:"Actions",accessor:t=>e.jsx("button",{onClick:()=>{h(t.uniqueOrderId),f(!0)},className:"text-white bg-[rgb(60,42,33)] py-2 px-4 rounded",children:"Cancel Order"})}],[x]);return e.jsxs(I,{children:[g&&e.jsx(H,{}),e.jsxs("div",{className:"flex flex-col",style:{marginBottom:"15rem"},children:[e.jsx("div",{className:"w-full",children:e.jsx("h2",{className:"text-center text-3xl font-bold mb-4",style:{color:"#3C2A21",marginTop:"3rem"},children:"Order Details"})}),e.jsx("div",{className:"w-full overflow-x-auto items-center justify-center",children:e.jsx(D,{columns:n,data:l})})]}),e.jsx(E,{isOpen:u,onRequestClose:()=>f(!1),orderId:p})]})}export{U as default};
